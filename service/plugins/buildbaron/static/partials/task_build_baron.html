<div class="row"><div class="col-lg-12">
<div class="buildbaron-panel" ng-controller="TaskBuildBaronCtrl"
    ng-show="conf.enabled && task.status == 'failed' && have_user">
    <h3>
        <img class="gravatar-small" src="/plugin/buildbaron/static/images/baron.png">
        </img>
        Build Baron
    </h3>
  <div class="mci-pod buildbaron-pod" ng-switch="build_baron_status">
    <div class="buildbaron-ticket row" ng-show="loaded">
      <div class="col-lg-12">
        <button class="btn btn-default" ng-show="!newTicket && (editTime || editing)" ng-click="clearTicket()">File Ticket</button>
        <div ng-show="newTicket" class="col-lg-12" >
          <div class="row">
            <h4>[BETA] Create a New BF JIRA Ticket</h4>
          </div>
          <div ng-show="!creatingTicket && !ticketKey">
            <div ng-show="failed.length>1">
              <div class="row">
                <p>
                Select which tests to include.
                Drag or shift-click to select multiple tests.
                </p>
              </div>
              <div class="row">
                <select multiple="multiple" class="form-control notes" ng-model="ticketTests">
                  <option ng-repeat="test in failed" value="[[test.test_file]]">[[test.display_name]]</option>
                </select>
              </div>
            </div>
            <div ng-show="failed.length==1">
              <div class="row">
                <p>
                Create a failure ticket for <code>[[failed[0].display_name]]</code>
                </p>
              </div>
            </div>
            <div ng-show="failed.length==0">
              <div class="row">
                <p>
                Create a failure ticket for this task.
                </p>
              </div>
            </div>
            <div class="row">
              <button class="btn btn-success" ng-click="fileTicket()">File Ticket</button>
            </div>
          </div>
          <div ng-show="!creatingTicket && ticketKey">
            <div class="row">
              <h4>Created <a ng-href=https://jira.mongodb.org/browse/[[ticketKey]]>[[ticketKey]]</a></h4>
            </div>
            <div class="row">
              <button class="btn btn-default" ng-click="clearTicket()">File Another</button>
            </div>
          </div>
          <div ng-show="creatingTicket">
            <span class="spinner"><i class="fa fa-spin fa-circle-o-notch"></i></span>
            Creating ticket
          </div>
        </div>
      </div>
    </div>
    <div class="buildbaron-notes row" style="margin-top:12px">
      <div class="col-lg-12">
        <pre ng-hide="editing || note==''" ng-bind-html="note | linky"></pre>
        <textarea name="note-text" ng-show="editing" class="form-control notes" rows="8" ng-model="note"></textarea>
        <button class="btn btn-default" ng-show="!newTicket && !editTime && !editing" ng-click="clearTicket()">File Ticket</button>
        <button class="btn btn-default" ng-show="loaded && !editing && note==''" ng-click="editing=true">Add Note</button>
        <button class="btn btn-default" ng-show="!editing && note!=''" ng-click="editing=true">Edit Note</button>
        <button class="btn btn-success" ng-show="editing" ng-click="saveNote()">Save Note</button>
        <span class="buildbaron-time" ng-show="editTime > 0">
          last edited on [[editTime | dateFromNanoseconds | convertDateToUserTimezone:userTz:"MMM D, YYYY h:mm:ss a"]]
        </span>
      </div>
    </div>
    <div class="buildbaron-results" ng-switch-when="loading">
      <span class="spinner"><i class="fa fa-spin fa-circle-o-notch"></i></span>
      Searching JIRA for tickets
    </div>
    <div ng-switch-when="error" class="buildbaron-results">Searching JIRA failed</div>
    <div ng-switch-when="nothing" class="buildbaron-results">No results found matching task or tests</div>
    <div ng-switch-when="success" class="buildbaron-results">
      <div class="buildbaron-issue" ng-repeat="issue in build_baron_results">
        <div class="buildbaron-row" ng-class="{'buildbaron-row-highlight': issue.statusKey==1}">
          <span class="buildbaron-issue-summary">
            <a ng-href="https://jira.mongodb.org/browse/[[issue.key]]">
              [[issue.key]]: [[issue.fields.summary]]
            </a>
          </span>
          <span ng-show="issue.statusKey==2" class="buildbaron-issue-status">
            [[issue.fields.status.name]]: [[issue.fields.resolution.name]]
          </span>
          <span ng-show="issue.statusKey==1" class="buildbaron-issue-status">
            [[issue.fields.status.name]]
          </span>
        </div>
        <div class="buildbaron-row">
          <div class="buildbaron-issue-detail buildbaron-issue-detail-left">
            Created: [[issue.fields.created | date]]
          </div>
          <div class="buildbaron-issue-detail buildbaron-issue-detail-middle">
            Update: [[issue.fields.updated | date]]
          </div>
          <div
               class="buildbaron-issue-detail buildbaron-issue-detail-right"
               ng-show="issue.fields.assignee.displayName != nil"
               >
               Assignee: [[issue.fields.assignee.displayName]]
          </div>
            <div
               class="buildbaron-issue-detail buildbaron-issue-detail-right"
               ng-show="issue.fields.assignee.displayName == nil"
               >
               Unassigned
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div></div>
