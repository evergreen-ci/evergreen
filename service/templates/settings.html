{{define "scripts"}}
<script type="text/javascript" src="{{Static "js" "settings.js"}}?hash={{ BuildRevision }}"></script>
<script type="text/javascript">
  var user_tz = {{.Data.Timezone}};
  var use_spruce_options = {{.Data.UseSpruceOptions}}
  var notifications = {{.Data.Notifications}}
  var slack_username = {{.Data.SlackUsername}}
  var github_user = {{ .GithubUser }};
  var github_uid = {{ .GithubUID }};
  var userApiKey = {{.User.APIKey}};
  var userConf = {{.Config}};
  var binaries = {{.Binaries}};
  var auth_is_ldap = {{.AuthIsLDAP}};
</script>
<style type="text/css">
  body{ background: rgb(250,250,250); }
</style>
{{end}}

{{define "title"}}
Settings for {{.User.Id}}
{{end}}


{{define "content"}}
<div id="content" class="container-fluid" ng-controller="SettingsCtrl">
  <notify-box ng-init="destination='errorHeader'"></notify-box>
  {{template "flash" . }}
  <section layout="row" flex>

    <md-content flex="50">
      <md-card>
        <h3 style="padding-left:15px;"><i class="fa fa-key"></i> Authentication</h3>
        <div class="mci-pod">
          <div>
            <p>Copy and paste these settings into ~/.evergreen.yml to authenticate the command line client.</p>
            <pre readonly style="font-family:monospace" id="conf">
user: "[[userConf.user]]"
api_key: "[[userConf.api_key]]"
api_server_host: "[[userConf.api_server_host]]"
ui_server_host: "[[userConf.ui_server_host]]"</pre>
            <div>
              <button ng-click="newKey()" class="btn btn-primary">Reset API Key</button>
              <button ng-show="auth_is_ldap" ng-click="clearToken()" class="btn btn-primary">Logout Everywhere</button>
            </div>
          </div>
        </div>
      </md-card>
    </md-content>

    <md-content flex="50">
      <md-card>
        <h3 style="padding-left:15px;"><i class="fa fa-download"></i> Command Line Client</h3>
        <div class="mci-pod">
          <div class="row">
            <div class="col-lg-3">
              <div ng-repeat="bin in binaries">
                <a ng-href="[[bin.url]]"> [[bin.os]]/[[bin.arch]]</a>
              </div>
            </div>
            <div class="col-lg-9">
              <p>The latest Evergreen command line client is available for download on these platforms.</p>
              <p>
              The command line client lets you run patch builds and debug project configuration files from your terminal.
              View the <a href="https://github.com/evergreen-ci/evergreen/wiki/Using-the-command-line-tool">documentation</a> or run <code>evergreen --help</code> or <code>evergreen [command] --help</code> for additional assistance.
              </p>
            </div>
          </div>
        </div>
      </md-card>
    </md-content>
  </section>

  <section layout="row">
    <md-content flex>
      <md-card flex="50">
        <h3 style="padding-left:15px;"><i class="fa fa-globe"></i> User Settings</h3>
        <div class="mci-pod">
          <form novalidate class="form-horizontal">
            <div class="form-group">
              <label for="timezone" class="col-sm-4 control-label">Timezone</label>
              <div class="col-sm-8">
                <select class="form-control" ng-model="new_tz" ng-options="t.value as t.str for t in timezones"></select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-4 control-label">Github Username</label>
              <div class="col-sm-8">
                  <input type="text" placeholder="octocat" ng-model="github_user" /> <label ng-show="{{ .GithubUID }} !== 0">Github UID Number: {{ .GithubUID }}</label>
              </div>
            </div>
            <div class="form-group" ng-hide="true">
              <div class="col-sm-4" style="text-align: right; margin-right:14px">Use New Patch Page</div>
              <md-checkbox ng-model="use_spruce_options.patch_page"/>
            </div>
            <div class="form-group">
              <a class="col-sm-4 control-label" href="/notifications"> Notification Settings </a>
            </div>
            <div class="right text-right"><button ng-click="updateUserSettings(new_tz, use_spruce_options)" class="btn btn-primary">Save</button></div>
          </form>
        </div>
      </md-card>
    </md-content>
  </section>
</div>
{{end}}
