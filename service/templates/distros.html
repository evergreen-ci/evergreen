{{define "scripts"}}
<script type="text/javascript" src="{{Static "js" "distros.js"}}?hash={{ BuildRevision }}"></script>
<script type="text/javascript">
  window.canCreateDistro = {{.CreateDistro}};
  window.distroIds = {{.DistroIds}};
  window.keys = {{.Keys}};
  window.containerPools = {{.ContainerPools}};
  window.containerPoolDistros = {{.ContainerPoolDistros}};
  window.containerPoolIds = {{.ContainerPoolIds}};
  window.architectures = {{.ArchDisplayNames}}
  window.validHostAllocatorRoundingRules = {{.ValidHostAllocatorRoundingRules}}
  window.validHostAllocatorFeedbackRules = {{.ValidHostAllocatorFeedbackRules}}
  window.validHostsOverallocatedRules = {{.ValidHostsOverallocatedRules}}
</script>
{{end}}
{{define "title"}}
Evergreen - Distros
{{end}}
{{define "content"}}
<div class="container" ng-controller="DistrosCtrl" style="margin-bottom: 15px; width:110%">
  <notify-box ng-init="destination='errorHeader'"></notify-box>
  {{template "flash" . }}
  <div ng-show="distroIds.length == 0">
    <h2>No Distros</h2>
    <div class="row">
      <button type="button" ng-hide="!createDistro" class="btn btn-primary" style="margin-left: 15px" ng-click="newDistro()"
        ng-disabled="activeDistro.new"><i class="fa fa-plus"></i>New Distro</button>
    </div>
  </div>
  <div ng-form="form" autocomplete="off" class="row">
    <div id="nav-container" class="col-md-2" ng-show="distroIds.length != 0" style="left:10%; max-width:350px">
      <div>
        <div>
          <h2 style="text-align: center;">Distros<span ng-show="distroIds.length != 0">([[distroIds.length]])</span></h2>
        </div>
        <div class="row" style="text-align: center;">
          <button type="button" class="btn btn-primary col-lg-8" ng-hide="!createDistro" style="margin-bottom: 10px; margin-left: 35px"
            ng-click="newDistro()" ng-disabled="activeDistro.new"><i class="fa fa-plus"></i>New Distro</button>
        </div>
        <div id="distros-list-container">
          <ul id="distros-list">
            <li ng-repeat="distroId in distroIds" ng-click="form.$setPristine();setActiveDistroId(distroId)" ng-class="{'active-distro': distroId == activeDistro._id}">
              [[distroId]]
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-lg-2"></div>
    <div class="col-lg-6 col-lg-offset-1" ng-show="distroIds.length != 0">
      <div ng-init="initOptions()">
        <div ng-show="activeDistro">
          <h2 style="display:inline-block; padding-right:15px">Configure
          </h2>
          <a class="pointer" ng-click="copyDistro()" ng-hide="tempDistro||!createDistro"> make a copy </a> /
          <a ng-href="/event_log/distro/[[activeDistro._id]]"> view event log </a>
        </div>
        <div style="padding-top: -25px;" class="panel-body panel-default">
          <div>
            <label class="distro-label">Identifier:</label>
            <input required ng-readonly="!activeDistro.new" id="identifier" name="id" type="text" class="form-control"
              ng-model="activeDistro._id" placeholder="Unique identifier for this distro">
            <label class="icon fa fa-warning distro-error" ng-show="form.id.$error.required">Distro identifier is
              required<br></label>
            <label class="icon fa fa-warning distro-error" ng-show="form.id.$dirty && form.id.$error.unsique || (activeDistro.new && form.id.$error.unique)">Distro
              identifier already exists</label>
            <label class="icon fa fa-warning" ng-show="containerPoolDistros.indexOf(activeDistro._id) >= 0">Distro is a
              container pool, so it is cannot be spawned for tasks.</label>
          </div>
          <br>
          <div class="panel-body panel panel-default">
            <div ng-form name="aliasesForm">
              <label class="distro-menu-title">Distro Aliases:</label>
              <div id="distro-aliases-table" class="distro-table-scroll">
                <table style="margin-left: -8px;" class="table distro-table">
                  <tbody ng-repeat="alias_name in activeDistro.aliases track by $index">
                    <tr>
                      <td style="padding-left: 10px;"><input required ng-readonly="readOnly" name="alias_name" type="text"
                          ng-model="activeDistro.aliases[$index]" class="form-control" placeholder="e.g. ubuntu1604">
                      </td>
                      <td ng-hide="readOnly">
                        <a ng-click="form.$setDirty();removeDistroAlias(alias_name)">
                          <i class="fa fa-trash distro-trash-icon"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="aliasesForm.alias_name.$dirty && aliasesForm.alias_name.$error.required">Distro alias
                cannot be an empty string<br /></div>
              <button type="button" class="btn btn-primary" ng-hide="readOnly" ng-disabled="aliasesForm.alias_name.$dirty && aliasesForm.$invalid || aliasesForm.alias_name.$error.required"
                ng-click="form.$setDirty();addDistroAlias()"><i class="fa fa-plus"></i> Add Distro Alias</button>
            </div>
          </div>
          <br>
          <div class="panel-body panel panel-default">
            <div class="dropdown">
              <span class="distro-menu-title">Host Allocator Version:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.host_allocator_settings.version | hostAllocatorVersionDisplay:this]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="hostAllocatorSettingsVersion" ng-click="form.$setDirty();activeDistro.host_allocator_settings.version = version.id" ng-repeat="version in hostAllocatorVersions"
                    role="presentation"><a role="menuitem" tabindex="-1">[[version.display]]</a></li>
                </ul>
            </div>
            <div class="icon fa fa-warning distro-error" ng-show="form.hostAllocatorSettingsVersion.$dirty && form.hostAllocatorSettingsVersion.$error.required ||
              form.hostAllocatorSettingsVersion.$invalid">Host Allocator Version is required
            </div>

            <div ng-show="!isStatic() && activeDistro.host_allocator_settings.version == 'utilization'" class="dropdown">
              <span class="distro-menu-title">Host Allocator Rounding Rule:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.host_allocator_settings.rounding_rule ]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="hostAllocatorSettingsRoundingRule" ng-click="form.$setDirty();activeDistro.host_allocator_settings.rounding_rule = rule" ng-repeat="rule in validHostAllocatorRoundingRules"
                    role="presentation"><a role="menuitem" tabindex="-1">[[rule]]</a></li>
                </ul>
            </div>
            <div ng-show="!isStatic() && activeDistro.host_allocator_settings.version == 'utilization'" class="dropdown">
              <span class="distro-menu-title">Host Allocator Feedback Rule:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.host_allocator_settings.feedback_rule ]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="hostAllocatorSettingsFeedbackRule" ng-click="form.$setDirty();activeDistro.host_allocator_settings.feedback_rule = rule" ng-repeat="rule in validHostAllocatorFeedbackRules"
                    role="presentation"><a role="menuitem" tabindex="-1">[[rule]]</a></li>
                </ul>
            </div>

            <div class="dropdown">
              <span class="distro-menu-title">Host Overallocation Rule:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.host_allocator_settings.hosts_overallocated_rule ]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="hostsOverallocatedRule" ng-click="form.$setDirty();activeDistro.host_allocator_settings.hosts_overallocated_rule = rule" ng-repeat="rule in validHostsOverallocatedRules"
                    role="presentation"><a role="menuitem" tabindex="-1">[[rule]]</a></li>
                </ul>
            </div>

            <div ng-show="!isStatic() && activeDistro.provider != 'docker'">
              <div>
                <label class="distro-label">Maximum Number of Hosts Allowed:</label>
                <input ng-readonly="readOnly" type="number" ng-required="!isStatic() && activeDistro.provider != 'docker'"
                  name="hostAllocatorSettingsMaximumHosts" class="form-control" ng-model="activeDistro.host_allocator_settings.maximum_hosts" placeholder="Maximum number of hosts e.g. 10">
                <div class="icon fa fa-warning distro-error" ng-show="form.hostAllocatorSettingsMaximumHosts.$dirty && form.hostAllocatorSettingsMaximumHosts.$error.required ||
                  form.hostAllocatorSettingsMaximumHosts.$invalid ||
                  form.hostAllocatorSettingsMaximumHosts.$modelValue < 0 ||
                  form.hostAllocatorSettingsMaximumHosts.$modelValue % 1 != 0"> A non-negative integer value for Maximum Hosts (a.k.a. Pool Size) is required
                </div>
              </div>
              <div>
                <label class="distro-label">Minimum Number of Hosts Allowed:</label>
                <input ng-readonly="readOnly" type="number"
                  name="hostAllocatorSettingsMinimumHosts" class="form-control" ng-model="activeDistro.host_allocator_settings.minimum_hosts" placeholder="Minimum number of hosts e.g. 0">
                <div class="icon fa fa-warning distro-error" ng-show="form.hostAllocatorSettingsMinimumHosts.$dirty && form.hostAllocatorSettingsMinimumHosts.$error.required ||
                  form.hostAllocatorSettingsMinimumHosts.$invalid ||
                  form.hostAllocatorSettingsMinimumHosts.$modelValue < 0 ||
                  form.hostAllocatorSettingsMinimumHosts.$modelValue % 1 != 0"> A non-negative integer value for Minimum Hosts is required
                </div>
              </div>
              <div>
                <label class="distro-label">Acceptable Host Idle Time (sec):</label>
                <input ng-readonly="readOnly" type="number"
                  name="hostAllocatorSettingsAcceptableHostIdleTime" class="form-control" ng-model="activeDistro.host_allocator_settings.acceptable_host_idle_time" placeholder="Set to 0 to use its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsAcceptableHostIdleTime.$dirty && form.hostAllocatorSettingsAcceptableHostIdleTime.$error.required ||
                form.hostAllocatorSettingsAcceptableHostIdleTime.$invalid ||
                form.hostAllocatorSettingsAcceptableHostIdleTime.$modelValue < 0 ||
                form.hostAllocatorSettingsAcceptableHostIdleTime.$modelValue % 1 != 0"> Acceptable Host Idle Time must a non-negative integer
              </div>
              <div>
                <label class="distro-label">Future Host Fraction</label>
                <input ng-readonly="readOnly" type="number" step=".01" min="0" max="1"
                  name="hostAllocatorSettingsFutureHostFraction" class="form-control" ng-model="activeDistro.host_allocator_settings.future_host_fraction" placeholder="Set to 0 to use its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.hostAllocatorSettingsFutureHostFraction.$dirty && form.hostAllocatorSettingsFutureHostFraction.$error.required ||
                form.hostAllocatorSettingsFutureHostFraction.$invalid ||
                form.hostAllocatorSettingsFutureHostFraction.$modelValue > 1 ||
                form.hostAllocatorSettingsFutureHostFraction.$modelValue < 0 "> future host fraction must fall in the interval [0,1]
              </div>
            </div>
          </div>
          <br>
          <div class="panel-body panel panel-default">
            <div class="dropdown">
              <span class="distro-menu-title">Task Finder Version:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.finder_settings.version | finderVersionDisplay:this]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="finderSettingsVersion" ng-click="form.$setDirty();activeDistro.finder_settings.version = version.id" ng-repeat="version in finderVersions"
                    role="presentation"><a role="menuitem" tabindex="-1">[[version.display]]</a></li>
                </ul>
            </div>
            <div class="icon fa fa-warning distro-error" ng-show="form.finderSettingsVersion.$dirty && form.finderSettingsVersion.$error.required ||
              form.finderSettingsVersion.$invalid">Task Finder Version is required
            </div>
          </div>
          <div class="panel-body panel panel-default">
            <div class="dropdown">
              <span class="distro-menu-title">Task Planner Version:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.planner_settings.version | plannerVersionDisplay:this]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="plannerSettingsVersion" ng-click="form.$setDirty();activeDistro.planner_settings.version = version.id" ng-repeat="version in plannerVersions"
                    role="presentation"><a role="menuitem" tabindex="-1">[[version.display]]</a></li>
                </ul>
            </div>
            <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsVersion.$dirty && form.plannerSettingsVersion.$error.required ||
              form.plannerSettingsVersion.$invalid">Planner Version is required
            </div>
            <div ng-show="!isStatic() && activeDistro.provider != 'docker' && activeDistro.planner_settings.version == 'tunable'">
              <div>
                <label class="distro-label">Target Time (sec):</label>
                <input ng-readonly="readOnly" type="number" ng-required="activeDistro.planner_settings.version == 'tunable'"
                  name="plannerSettingsTargetTime" class="form-control" ng-model="activeDistro.planner_settings.target_time" placeholder="Set to 0 to use its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsTargetTime.$dirty && form.plannerSettingsTargetTime.$error.required ||
                form.plannerSettingsTargetTime.$invalid ||
                form.plannerSettingsTargetTime.$modelValue < 0 ||
                form.plannerSettingsTargetTime.$modelValue % 1 != 0"> Target Time must be a non-negative integer
              </div>
              <div>
                <label class="distro-label">Patch Factor (0 to 100 inclusive):</label>
                <input ng-readonly="readOnly" type="number" ng-required="activeDistro.planner_settings.version == 'tunable'"
                  name="plannerSettingsPatchFactor" class="form-control" ng-model="activeDistro.planner_settings.patch_factor" placeholder="Set to 0 to use the its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsPatchFactor.$dirty && form.plannerSettingsPatchFactor.$error.required ||
                form.plannerSettingsPatchFactor.$invalid ||
                form.plannerSettingsPatchFactor.$modelValue > 100 ||
                form.plannerSettingsPatchFactor.$modelValue < 0 ||
                form.plannerSettingsPatchFactor.$modelValue % 1 != 0"> Patch Factor must be an integer between 0 and 100
              </div>
              <div>
                <label class="distro-label">Time In Queue Factor (0 to 100 inclusive):</label>
                <input ng-readonly="readOnly" type="number" ng-required="activeDistro.planner_settings.version == 'tunable'"
                  name="plannerSettingsTimeInQueueFactor" class="form-control" ng-model="activeDistro.planner_settings.time_in_queue_factor" placeholder="Set to 0 to use its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsTimeInQueueFactor.$dirty && form.plannerSettingsTimeInQueueFactor.$error.required ||
                form.plannerSettingsTimeInQueueFactor.$invalid ||
                form.plannerSettingsTimeInQueueFactor.$modelValue > 100 ||
                form.plannerSettingsTimeInQueueFactor.$modelValue < 0 ||
                form.plannerSettingsTimeInQueueFactor.$modelValue % 1 != 0"> Time In Queue Factor must be an integer between 0 and 100
              </div>
              <div>
                <label class="distro-label">Expected Runtime Factor (0 to 100 inclusive):</label>
                <input ng-readonly="readOnly" type="number" ng-required="activeDistro.planner_settings.version == 'tunable'"
                  name="plannerSettingsExpectedRuntimeFactor" class="form-control" ng-model="activeDistro.planner_settings.expected_runtime_factor" placeholder="Set to 0 to use its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsExpectedRuntimeFactor.$dirty && form.plannerSettingsExpectedRuntimeFactor.$error.required ||
                form.plannerSettingsExpectedRuntimeFactor.$invalid ||
                form.plannerSettingsExpectedRuntimeFactor.$modelValue > 100 ||
                form.plannerSettingsExpectedRuntimeFactor.$modelValue < 0 ||
                form.plannerSettingsExpectedRuntimeFactor.$modelValue % 1 != 0"> Time In Queue Factor must be an integer between 0 and 100
              </div>
              <div>
                <label class="distro-label">Generate Task Factor (0 to 100 inclusive):</label>
                <input ng-readonly="readOnly" type="number" ng-required="activeDistro.planner_settings.version == 'tunable'"
                       name="plannerSettingsGenerateTaskFactor" class="form-control" ng-model="activeDistro.planner_settings.generate_task_factor" placeholder="Set to 0 to use its global default">
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.plannerSettingsGenerateTaskFactor.$dirty && form.plannerSettingsGenerateTaskFactor.$error.required ||
                form.plannerSettingsGenerateTaskFactor.$invalid ||
                form.plannerSettingsGenerateTaskFactor.$modelValue > 100 ||
                form.plannerSettingsGenerateTaskFactor.$modelValue < 0 ||
                form.plannerSettingsGenerateTaskFactor.$modelValue % 1 != 0"> Time In Queue Factor must be an integer between 0 and 100
              </div>
              <br/>
              <div>
                <span class="distro-menu-title">Group Versions:</span>
                <label>
                  <input name="plannerSettingsGroupVersionsYes" style="margin-left:10px;margin-right:10px;" type="radio"
                    ng-change="form.$setDirty();" ng-model="activeDistro.planner_settings.group_versions" ng-value=true />Yes
                </label>
                <label>
                  <input name="plannerSettingsGroupVersionsNo" style="margin-left:10px;margin-right:10px;" type="radio"
                    ng-change="form.$setDirty();" ng-model="activeDistro.planner_settings.group_versions" ng-value=false />No
                </label>
                </div>
            </div>
            <div ng-form name="hostProviderForm" ng-show="isStatic()">
              <label class="distro-label">Hosts<span ng-show="activeDistro.settings.hosts && activeDistro.settings.hosts.length != 0">([[activeDistro.settings.hosts.length]])</span>:</label>
              <div id="hosts-table" class="distro-table-scroll">
                <table style="margin-left: -8px;" class="table distro-table" ng-show="activeDistro.settings.hosts">
                  <tbody id="hosts-table">
                    <tr ng-repeat="host in activeDistro.settings.hosts">
                      <td>
                        <input ng-readonly="readOnly" required name="hostName" type="text" ng-model="host.name" class="col-md-10"
                          placeholder="Machine DNS name">
                        <input ng-readonly="readOnly" name="hostSSHPort" type="number" ng-model="host.ssh_port" class="col-md-10"
                            placeholder="SSH port">
                      </td>
                      <td ng-hide="readOnly"><a ng-click="form.$setDirty();removeHost(host)"><i class="fa fa-trash distro-trash-icon"></i></a></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div>
                <div class="icon fa fa-warning distro-error" ng-show="hostProviderForm.hostName.$dirty && hostProviderForm.hostName.$error.required">Static
                  host cannot be blank<br /></div>
                <br />
                <button type="button" ng-hide="readOnly" ng-disabled="hostProviderForm.hostName.$dirty && hostProviderForm.$invalid || hostProviderForm.hostName.$error.required"
                  class="btn btn-primary" ng-click="form.$setDirty();addHost()"><i class="fa fa-plus"></i>Add Host</button>
              </div>
            </div>
          </div>
          <div class="panel-body panel panel-default">
            <div class="dropdown">
              <span class="distro-menu-title">Task Dispatcher Version:</span>
                <button style="margin-left:5px;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
                  ng-disabled="readOnly">
                  <strong class="distro-menu-item">[[ activeDistro.dispatcher_settings.version | dispatcherVersionDisplay:this]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                  <li required name="dispatcherSettingsVersion" ng-click="form.$setDirty();activeDistro.dispatcher_settings.version = version.id" ng-repeat="version in dispatcherVersions"
                    role="presentation"><a role="menuitem" tabindex="-1">[[version.display]]</a></li>
                </ul>
            </div>
            <div class="icon fa fa-warning distro-error" ng-show="form.dispatcherSettingsVersion.$dirty && form.dispatcherSettingsVersion.$error.required ||
              form.dispatcherSettingsVersion.$invalid">Task Dispatcher Version is required
            </div>
          </div>
          <br>
          <div class="panel-body panel panel-default">
            <div class="dropdown">
              <span class="distro-menu-title">Provider:</span>
              <button class="btn btn-default dropdown-toggle" ng-disabled="readOnly" type="button" data-toggle="dropdown">
                <strong class="distro-menu-item">[[activeDistro.provider | providerDisplay:this]]<span class="fa fa-caret-down"></span></strong>
              </button>
              <ul class="dropdown-menu" role="menu" style="margin-left: 60px">
                <li ng-click="form.$setDirty();setKeyValue('provider', provider.id)" required name="providerForm"
                  ng-repeat="provider in providers" role="presentation"><a role="menuitem" tabindex="-1">[[provider.display]]</a></li>
              </ul>
              <div class="icon fa fa-warning distro-error" ng-show="form.providerForm.$dirty && form.providerForm.$error.required">Distro
                provider is required</div>
            </div>
            <div ng-show="activeDistro.provider == 'docker'">
              <div>
                <label class="distro-label">Docker Image URL:</label>
                <input type="text" ng-required="activeDistro.provider == 'docker'" name="imageUrl" class="form-control"
                  ng-model="activeDistro.settings.image_url" placeholder="Docker image URL to import on host machine"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.imageUrl.$dirty && form.imageUrl.$error.required || form.imageUrl.$invalid">Image
                  URL is required</div>
              </div>
              <div>
                <label class="distro-label">Image Build Method:</label>
                <select ng-readonly="readOnly" ng-model="activeDistro.settings.build_type" ng-required="activeDistro.provider == 'docker'">
                  <option value="import" default>import</option>
                  <option value="import" default>pull</option>
                </select>
              </div>
              <div>
                <label class="distro-label">Username for Registries:</label>
                <input type="text" class="form-control" ng-model="activeDistro.settings.docker_registry_user" ng-readonly="readOnly">
              </div>
              <div>
                <label class="distro-label">Password for Registries:</label>
                <input type="password" autocomplete="new-password" class="form-control" ng-model="activeDistro.settings.docker_registry_pw" ng-readonly="readOnly">
              </div>
              <div>
                <label class="distro-label">Pool ID:</label>
                <select ng-readonly="readOnly" name="poolID" ng-model="activeDistro.container_pool" ng-required="activeDistro.provider == 'docker'">
                  <option ng-repeat="pool in containerPoolIds" value=[[pool]]>[[pool]]</option>
                </select>
                <div ng-show="checkPoolID(form.poolID.$modelValue)">
                  <label class="distro-label"> Pool Mapping Information:</label>
                  <p style="font-family:courier new, courier, monospace;" ng-repeat="(key, value) in displayContainerPool(form.poolID.$modelValue)">[[key]]:
                    [[value]]</p>
                </div>
              </div>
            </div>
            <div ng-show="activeDistro.provider.startsWith('ec2')">
              <div class="dropdown" ng-show="regions.length > 1" style="top:10px;">
                <span class="distro-menu-title">Current Region:</span>
                <button class="btn btn-default dropdown-toggle" ng-disabled="readOnly" type="button" data-toggle="dropdown">
                  <strong class="distro-menu-item">[[activeDistro.settings.region]]<span class="fa fa-caret-down"></span></strong>
                </button>
                <ul class="dropdown-menu" role="menu" style="margin-left: 60px">
                  <li ng-click="switchRegion(region)" required name="regionForm"
                      ng-repeat="region in regions" role="presentation"><a role="menuitem" tabindex="-1">[[region]]</a></li>
                </ul>
                <div class="icon fa fa-warning distro-error" ng-show="form.regionForm.$dirty && form.regionForm.$error.required">Distro
                  Region is required</div>
              </div>
              <div>
                <label class="distro-label">AMI ID:</label>
                <input ng-readonly="readOnly" type="text" name="ami" ng-required="isDefaultRegion() && activeDistro.provider.startsWith('ec2')"
                  class="form-control" ng-model="activeDistro.settings.ami" placeholder="EC2 image identifier e.g. ami-1ecae776"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.ami.$dirty && form.ami.$error.required || form.ami.$invalid">AMI
                  ID is required</div>
              </div>
              <div>
                <label class="distro-label">Instance Type:</label>
                <input ng-readonly="readOnly" type="text" ng-required="isDefaultRegion() && activeDistro.provider.startsWith('ec2')" name="instanceType"
                  class="form-control" ng-model="activeDistro.settings.instance_type" placeholder="EC2 instance type for the AMI e.g t1.micro (must be available)"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.instanceType.$dirty && form.instanceType.$error.required || form.instanceType.$invalid">Instance
                  type is required</div>
              </div>
              <div>
                <label class="distro-label">Key Name:</label>
                <input type="text" ng-readonly="readOnly" name="keyName"
                  class="form-control" ng-model="activeDistro.settings.key_name" placeholder="SSH Key (public part in EC2) to add on host machine"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.keyName.$dirty && form.keyName.$error.required || form.keyName.$invalid">EC2
                  key name is required</div>
              </div>
              <div ng-show="activeDistro.provider === 'ec2-fleet'">
                <br>
                <div class="dropdown">
                  <span class="distro-menu-title">Instance Type:</span>
                  <button class="btn btn-default dropdown-toggle" ng-disabled="readOnly" type="button" data-toggle="dropdown">
                    <strong class="distro-menu-item">[[getFleetInstanceType(activeDistro.settings) | fleetInstanceTypeDisplay:this]]<span class="fa fa-caret-down"></span></strong>
                  </button>
                  <ul class="dropdown-menu" role="menu" style="margin-left: 60px">
                    <li ng-click="form.$setDirty();setFleetInstanceType(instance_type.id)" required
                      ng-repeat="instance_type in fleetInstanceTypes" role="presentation"><a role="menuitem" tabindex="-1">[[instance_type.display]]</a></li>
                  </ul>
                </div>
                <label><input style="margin-right:10px;" ng-disabled="readOnly || activeDistro.settings.fleet_options.use_on_demand" type="checkbox"
                  name="use_capacity_optimized" ng-model="activeDistro.settings.fleet_options.use_capacity_optimized">Use the capacity-optimized allocation strategy for spot (default: lowest-cost)</label> <br>
              </div>
                <label><input style="margin-right:10px;" ng-disabled="readOnly" type="checkbox"
                  name="is_vpc" ng-model="activeDistro.settings.is_vpc">Use security group in an EC2 VPC </label> <br>
              </div>
              <div>
                <label class="distro-label">Security Groups:</label>
                <textarea ng-readonly="readOnly" placeholder="List 1 security group per line" ng-required="isDefaultRegion() && activeDistro.provider.startsWith('ec2')"
                  type="text" wrap="off" class="form-control" rows="3" name="securityGroups" ng-model="activeDistro.settings.security_group_ids"
                  ng-list="&#10;" ng-trim="false" style="margin-left: 0px; font-family: monospace"></textarea>
                <div class="icon fa fa-warning distro-error" ng-show="form.securityGroups.$dirty && form.securityGroups.$error.required || form.securityGroups.$invalid">Security
                  group is required</div>
                <div class="icon fa fa-warning distro-error" ng-show="!validSecurityGroup()">Security group for EC2 VPC
                  must be the id (starts with 'sg-')</div>
              </div>
              <div>
                <label class="distro-label">IAM Instance Profile ARN:</label>
                <input type="text" ng-readonly="readOnly" name="IAMInstanceProfileARN" class="form-control"
                  ng-model="activeDistro.settings.iam_instance_profile_arn" placeholder="The Amazon Resource Name (ARN) of the instance profile."
                  ng-readonly="readOnly">
              </div>
              <div ng-show="activeDistro.settings.is_vpc">
                <label class="distro-label">Default VPC Subnet Id:</label>
                <input type="text" name="subnet_id" ng-readonly="readOnly" class="form-control" ng-model="activeDistro.settings.subnet_id"
                  placeholder="EC2 subnet id (must already exist) e.g subnet-xxxx" ng-required="activeDistro.settings.is_vpc">
                <div class="icon fa fa-warning distro-error" ng-show="form.securityGroup.$dirty && form.subnet_id.$error.required || form.subnet_id.$invalid || !validSubnetId()">
                  Subnet Id is required for EC2 VPC (must start with 'subnet-')</div>
              </div>
              <div ng-show="activeDistro.settings.is_vpc">
                <label class="distro-label">VPC Subnet Prefix:</label>
                <input type="text" name="vpc_name" ng-readonly="readOnly" class="form-control" ng-model="activeDistro.settings.vpc_name"
                  placeholder="will look for subnets like <prefix>.subnet_1a, <prefix>.subnet_1b, etc.">
              </div>
              <div ng-show="activeDistro.provider.startsWith('ec2')">
                <div id="mounts-table" class="distro-table-scroll">
                  <label class="distro-label">Mount Points:</label>
                  <table ng-form name="mountPoints" class="table distro-table" ng-show="activeDistro.settings.mount_points"
                    ng-init="form.devName=''; form.devSize=''">
                    <thead class="muted">
                      <tr>
                        <th>Device Name</th>
                        <th>Virtual Name</th>
                        <th>Volume Type</th>
                        <th>IOPS</th>
                        <th>Throughput</th>
                        <th>Size</th>
                      </tr>
                    </thead>
                    <tbody ng-repeat="mount_point in activeDistro.settings.mount_points">
                      <tr>
                        <td><input ng-readonly="readOnly" required name="devName" type="text" ng-model="mount_point.device_name"
                            class="form-control"></td>
                        <td><input ng-readonly="readOnly" ng-required="!mount_point.size" name="virtName" type="text"
                            ng-model="mount_point.virtual_name" class="form-control"></td>
                        <td><input ng-readonly="readOnly" name="volType" type="text" ng-model="mount_point.volume_type"
                            class="form-control"></td>
                        <td><input ng-readonly="readOnly" name="iops" type="number" ng-model="mount_point.iops" class="form-control"></td>
                        <td><input ng-readonly="readOnly" name="throughput" type="number" ng-model="mount_point.throughput" class="form-control"></td>
                        <td><input ng-readonly="readOnly" ng-required="!mount_point.virtual_name" name="devSize" type="number"
                            ng-model="mount_point.size" class="form-control"></td>
                        <td ng-hide="readOnly"><a ng-click="form.$setDirty();removeMount(mount_point)"><i style="margin-top:9px"
                              class="fa fa-trash distro-trash-icon"></i></a></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div>
                <div class="icon fa fa-warning distro-error" ng-show="mountPoints.devName.$dirty && mountPoints.devName.$error.required">Device
                  name is required<br /></div>
                <div class="icon fa fa-warning distro-error" ng-show="mountPoints.devName.$dirty && mountPoints.virtName.$error.required && mountPoints.devSize.$error.required">Must
                  specify either virtual device name or device size<br /></div>
                <button ng-hide="readOnly" type="button" ng-disabled="mountPoints.devName.$dirty && mountPoints.$invalid || mountPoints.devName.$error.required"
                  class="btn btn-primary" ng-click="form.$setDirty();addMount()"><i class="fa fa-plus"></i>Add Mount
                  Point</button>
              </div>
              <div>
                <div>
                  <label class="distro-label">User Data:</label>
                  <span style="float: right; margin-top: 20px;" class="distro-checkbox checkbox">
                    <input ng-disabled="readOnly" type="checkbox" ng-model="activeDistro.settings.merge_user_data_parts">Merge with existing user data
                  </span>
                </div>
                <textarea ng-readonly="readOnly" name="script" type="text" wrap="off" class="form-control" rows="7"
                  ng-model="activeDistro.settings.user_data" style="margin-left: 0px; font-family: monospace"></textarea>
              </div>
              <div ng-show="regions.length > 1" style="margin-top:10px;">
                <button ng-hide="readOnly" type="button" class="btn btn-danger" ng-click="form.$setDirty();clearSettings()">Clear Region's Settings</button>
              </div>
            </div>
            <div ng-show="activeDistro.provider == 'openstack'">
              <div>
                <label class="distro-label">Image Name:</label>
                <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'openstack'" name="imageName"
                  class="form-control" ng-model="activeDistro.settings.image_name" placeholder="OpenStack image name e.g. xenial-server"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.imageName.$dirty && form.imageName.$error.required || form.imageName.$invalid">Image
                  name is required</div>
              </div>
              <div>
                <label class="distro-label">Flavor Name:</label>
                <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'openstack'" name="flavorName"
                  class="form-control" ng-model="activeDistro.settings.flavor_name" placeholder="OpenStack flavor name for the image e.g m1.tiny (must be available)"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.flavorName.$dirty && form.flavorName.$error.required || form.flavorName.$invalid">Flavor
                  name is required</div>
              </div>
              <div>
                <label class="distro-label">Key Name:</label>
                <input type="text" ng-readonly="readOnly" ng-required="activeDistro.provider == 'openstack'" name="keyName"
                  class="form-control" ng-model="activeDistro.settings.key_name" placeholder="SSH Key (public part in OpenStack cloud) to add on host machine"
                  ng-readonly="readOnly">
                <div class="icon fa fa-warning distro-error" ng-show="form.keyName.$dirty && form.keyName.$error.required || form.keyName.$invalid">OpenStack
                  key name is required</div>
              </div>
              <div>
                <label class="distro-label">Security Group:</label>
                <input type="text" ng-readonly="readOnly" ng-required="activeDistro.provider == 'openstack'" name="securityGroup"
                  ng-model="activeDistro.settings.security_group" placeholder="OpenStack security group (must already exist)"
                  class="form-control">
                <div class="icon fa fa-warning distro-error" ng-show="form.securityGroup.$dirty && form.securityGroup.$error.required || form.securityGroup.$invalid">Security
                  group is required</div>
              </div>
            </div>
            <div ng-show="activeDistro.provider == 'gce'">
              <div>
                <label class="distro-label">Project ID:</label>
                <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'gce'" name="projectID"
                  class="form-control" ng-model="activeDistro.settings.project_id" placeholder="Google Cloud project ID e.g. abc-abc-123">
                <div class="icon fa fa-warning distro-error" ng-show="form.projectID.$dirty && form.projectID.$error.required || form.projectID.$invalid">Project
                  ID is required</div>
              </div>
              <div>
                <label class="distro-label">Zone:</label>
                <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'gce'" name="zone"
                  class="form-control" ng-model="activeDistro.settings.zone" placeholder="geographical zone e.g. us-east1-c">
                <div class="icon fa fa-warning distro-error" ng-show="form.zone.$dirty && form.zone.$error.required || form.zone.$invalid">Zone
                  is required</div>
              </div>
              <br>
              <div>
                <label>Image:</label>
                <div>
                  <label>
                    <input type="radio" ng-model="activeDistro.settings.image" value="imageName" />
                    Image Name
                  </label>
                  <label>
                    <input type="radio" ng-model="activeDistro.settings.image" value="imageFamily" />
                    Image Family
                  </label>
                </div>
                <div class="icon fa fa-warning distro-error" ng-show="activeDistro.settings.image == null">Image name
                  or image family is required</div>
                <div>
                  <div ng-show="activeDistro.settings.image == 'imageName'">
                    <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'gce' && activeDistro.settings.image == 'imageName'"
                      name="imageName" class="form-control" ng-model="activeDistro.settings.image_name" placeholder="the disk will use the private image of the specified name">
                    <div class="icon fa fa-warning distro-error" ng-show="form.imageName.$dirty && form.imageName.$error.required || form.imageName.$invalid">Image
                      name is required</div>
                  </div>
                  <div ng-show="activeDistro.settings.image == 'imageFamily'">
                    <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'gce' && activeDistro.settings.image == 'imageFamily'"
                      name="imageFamily" class="form-control" ng-model="activeDistro.settings.image_family" placeholder="the disk will use the newest image from the private image family">
                    <div class="icon fa fa-warning distro-error" ng-show="form.imageFamily.$dirty && form.imageFamily.$error.required || form.imageFamily.$invalid">Image
                      family is required</div>
                  </div>
                </div>
              </div>
              <div>
                <br>
                <label>Machine Type:</label>
                <div>
                  <label>
                    <input type="radio" ng-model="activeDistro.settings.machine" value="standard" />
                    Standard
                  </label>
                  <label>
                    <input type="radio" ng-model="activeDistro.settings.machine" value="custom" />
                    Custom
                  </label>
                </div>
                <div class="icon fa fa-warning distro-error" ng-show="activeDistro.settings.machine == null">Machine
                  type is required</div>
                <div>
                  <div ng-show="activeDistro.settings.machine == 'standard'">
                    <label>Instance Type:</label>
                    <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'gce' && activeDistro.settings.machine == 'standard'"
                      name="instanceType" class="form-control" ng-model="activeDistro.settings.instance_type"
                      placeholder="instance type e.g. n1-standard-8">
                    <div class="icon fa fa-warning distro-error" ng-show="form.instanceType.$dirty && form.instanceType.$error.required || form.instanceType.$invalid">Instance
                      type is required</div>
                  </div>
                  <div ng-show="activeDistro.settings.machine == 'custom'">
                    <label>Number of CPUs:</label>
                    <input ng-readonly="readOnly" type="number" ng-required="activeDistro.provider == 'gce' && activeDistro.settings.machine == 'custom'"
                      name="numCPUs" class="form-control" ng-model="activeDistro.settings.num_cpus" placeholder="number of cores e.g. 2">
                    <div class="icon fa fa-warning distro-error" ng-show="form.numCPUs.$dirty && form.numCPUs.$error.required || form.numCPUs.$invalid">Number
                      of CPUs is required</div>
                  </div>
                  <div ng-show="activeDistro.settings.machine == 'custom'">
                    <label>Memory (MB):</label>
                    <input ng-readonly="readOnly" type="number" ng-required="activeDistro.provider == 'gce' && activeDistro.settings.machine == 'custom'"
                      name="memoryMB" class="form-control" ng-model="activeDistro.settings.memory_mb" placeholder="memory, in MB e.g. 2048">
                    <div class="icon fa fa-warning distro-error" ng-show="form.memoryMB.$dirty && form.memoryMB.$error.required || form.memoryMB.$invalid">Memory
                      is required</div>
                  </div>
                </div>
              </div>
              <div>
                <label class="distro-label">Disk Type:</label><br>
                <select ng-readonly="readOnly" name="diskType" ng-model="activeDistro.settings.disk_type" ng-required="activeDistro.provider == 'gce'">
                  <option value="pd-standard">Standard persistent disk</option>
                  <option value="pd-ssd">SSD persistent disk</option>
                </select>
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="form.diskType.$dirty && form.diskType.$error.required || form.diskType.$invalid">Disk
                type is required</div>
              <div>
                <label class="distro-label">Disk Size (GB):</label>
                <input ng-readonly="readOnly" type="number" ng-required="activeDistro.provider == 'gce'" name="diskSizeGB"
                  class="form-control" ng-model="activeDistro.settings.disk_size_gb" placeholder="boot disk size, in base-2 GB e.g. 10">
                <div class="icon fa fa-warning distro-error" ng-show="form.diskSizeGB.$dirty && form.diskSizeGB.$error.required || form.diskSizeGB.$invalid">Numeric
                  disk size is required</div>
              </div>
              <div id="network-tags-table" class="distro-table-scroll">
                <label class="distro-label">Network Tags:</label>
                <table ng-form name="networkTags" class="table distro-table" ng-show="activeDistro.settings.network_tags"
                  ng-init="form.devName=''; form.devSize=''">
                  <tbody ng-repeat="tag in activeDistro.settings.network_tags track by $index">
                    <tr>
                      <td><input ng-readonly="readOnly" required name="tag" type="text" ng-model="activeDistro.settings.network_tags[$index]"
                          class="form-control"></td>
                      <td ng-hide="readOnly"><a ng-click="form.$setDirty();removeNetworkTag(tag)"><i style="margin-top:9px"
                            class="fa fa-trash distro-trash-icon"></i></a></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div>
                <div class="icon fa fa-warning distro-error" ng-show="networkTags.tag.$dirty && networkTags.tag.$error.required">Tag
                  is required<br /></div>
                <button ng-hide="readOnly" type="button" ng-disabled="(networkTags.tag.$dirty) && networkTags.$invalid"
                  class="btn btn-primary" ng-click="form.$setDirty();addNetworkTag()"><i class="fa fa-plus"></i>Add Tag</button>
              </div>
              <div id="ssh-keys-table" class="distro-table-scroll">
                <label class="distro-label">Instance SSH Keys:</label>
                <table ng-form name="sshKeys" class="table distro-table" ng-show="activeDistro.settings.ssh_keys"
                  ng-init="form.devName=''; form.devSize=''">
                  <thead class="muted">
                    <tr>
                      <th>Username</th>
                      <th>Public Key</th>
                    </tr>
                  </thead>
                  <tbody ng-repeat="ssh_key in activeDistro.settings.ssh_keys">
                    <tr>
                      <td><input ng-readonly="readOnly" required name="username" type="text" ng-model="ssh_key.username"
                          class="form-control"></td>
                      <td><input ng-readonly="readOnly" required name="public_key" type="text" ng-model="ssh_key.public_key"
                          class="form-control"></td>
                      <td ng-hide="readOnly"><a ng-click="form.$setDirty();removeInstanceSSHKey(ssh_key)"><i style="margin-top:9px"
                            class="fa fa-trash distro-trash-icon"></i></a></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div>
                <div class="icon fa fa-warning distro-error" ng-show="sshKeys.username.$dirty && sshKeys.username.$error.required">Username
                  is required<br /></div>
                <div class="icon fa fa-warning distro-error" ng-show="sshKeys.public_key.$dirty && sshKeys.public_key.$error.required">Public
                  key is required<br /></div>
                <button ng-hide="readOnly" type="button" ng-disabled="(sshKeys.username.$dirty || sshKeys.public_key.$dirty) && sshKeys.$invalid"
                  class="btn btn-primary" ng-click="form.$setDirty();addInstanceSSHKey()"><i class="fa fa-plus"></i>Add
                  SSH Key</button>
              </div>
            </div>
            <div ng-show="activeDistro.provider == 'vsphere'">
              <div>
                <label class="distro-label">Template:</label>
                <input ng-readonly="readOnly" type="text" ng-required="activeDistro.provider == 'vsphere'" name="template"
                  class="form-control" ng-model="activeDistro.settings.template" placeholder="name of the template VM e.g. osx-1012-template">
                <div class="icon fa fa-warning distro-error" ng-show="form.template.$dirty && form.template.$error.required || form.template.$invalid">Template
                  is required</div>
              </div>
              <div>
                <label class="distro-label">Datastore:</label>
                <input ng-readonly="readOnly" type="text" name="datastore" class="form-control" ng-model="activeDistro.settings.datastore"
                  placeholder="(optional) name/path of the datastore to attach e.g. 1TB_SSD">
              </div>
              <div>
                <label class="distro-label">Resource Pool:</label>
                <input type="text" ng-readonly="readOnly" name="resourcePool" class="form-control" ng-model="activeDistro.settings.resource_pool"
                  placeholder="(optional) name/path of a resource pool e.g. Resources">
              </div>
              <div>
                <label class="distro-label">Number of CPUs:</label>
                <input type="number" ng-readonly="readOnly" name="numCPUs" ng-model="activeDistro.settings.num_cpus"
                  placeholder="(optional) number of CPUs e.g. 2" class="form-control">
              </div>
              <div>
                <label class="distro-label">Memory (MB):</label>
                <input type="number" ng-readonly="readOnly" name="memoryMB" ng-model="activeDistro.settings.memory_mb"
                  placeholder="(optional) memory in MB e.g. 2048" class="form-control">
              </div>
            </div>
          </div>
          <br>

        <div class="panel-body panel panel-default">
          <div class="dropdown">
            <span class="distro-menu-title">Host Bootstrap Method:</span>
              <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true" ng-disabled="readOnly">
                <strong class="distro-menu-item">[[activeDistro.bootstrap_settings.method | bootstrapMethodDisplay:this]]<span class="fa fa-caret-down"></span></strong>
              </button>
              <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                <li required name="bootstrapMethodForm" ng-click="form.$setDirty();activeDistro.bootstrap_settings.method = bootstrapMethod.id" ng-repeat="bootstrapMethod in bootstrapMethods"
                  role="presentation"><a role="menuitem" tabindex="-1">[[bootstrapMethod.display]]</a></li>
              </ul>
          </div>
          <br />
          <div class="icon fa fa-warning distro-error" ng-show="form.bootstrapMethodForm.$dirty && form.bootstrapMethodForm.$invalid || bootstrapMethodForm.$error.required"> Bootstrap method is required</div>

          <div class="dropdown">
            <span class="distro-menu-title">Host Communication Method:</span>
              <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true" ng-disabled="readOnly">
                <strong class="distro-menu-item">[[activeDistro.bootstrap_settings.communication | communicationMethodDisplay:this]]<span class="fa fa-caret-down"></span></strong>
              </button>
              <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
                <li required name="communicationMethodForm" ng-click="form.$setDirty();activeDistro.bootstrap_settings.communication = communicationMethod.id" ng-repeat="communicationMethod in communicationMethods"
                  role="presentation"><a role="menuitem" tabindex="-1">[[communicationMethod.display]]</a></li>
              </ul>
          </div>
          <div class="icon fa fa-warning distro-error" ng-show="form.communicationMethodForm.$dirty && form.communicationMethodForm.$invalid || communicationMethodForm.$error.required"> Communication method is required</div>

          <div class="icon fa fa-warning distro-error" ng-show="!validBootstrapAndCommunication()"> Legacy and non-legacy bootstrapping and communication are incompatible</div>
          <br />

          <div class="dropdown">
            <span class="distro-menu-title">Agent Architecture:</span>
            <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true"
              ng-disabled="readOnly">
              <strong class="distro-menu-item">[[activeDistro.arch | archDisplay:this]]<span class="fa fa-caret-down"></span></strong>
            </button>
            <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
              <li ng-click="form.$setDirty();setKeyValue('arch', arch.id)" required name="agentArch" ng-repeat="arch in architectures | orderBy:'display'"
                role="presentation"><a role="menuitem" tabindex="-1">[[arch.display]]</a></li>
            </ul>
            <div class="icon fa fa-warning distro-error" ng-show="form.agentArch.$dirty && form.agentArch.$error.required || form.agentArch.$invalid"> Agent
              architecture is required</div>
          </div>
          <div>
            <label class="distro-label">User:</label>
            <input required ng-readonly="readOnly" name="userName" type="text" class="form-control" ng-model="activeDistro.user"
              placeholder="Username with which to SSH into host machine">
            <div class="icon fa fa-warning distro-error" ng-show="form.userName.$dirty && form.userName.$error.required || form.userName.$invalid">SSH
              user is required</div>
          </div>
          <div>
            <label class="distro-label">Working Directory:</label>
            <input required name="workDir" type="text" class="form-control" ng-model="activeDistro.work_dir"
              placeholder="Absolute path in which agent runs tasks on host machine" ng-readonly="readOnly">
            <div class="icon fa fa-warning distro-error" ng-show="form.workDir.$dirty && form.workDir.$error.required || form.workDir.$invalid"> Working
              Directory is required</div>
          </div>
          <div ng-form name="diskMountpointsForm">
            <label class="distro-label">Disk Mountpoints:</label>
            <div id="mountpoints-table" class="distro-table-scroll">
              <table style="margin-left: -8px;" class="table distro-table">
                <tbody ng-repeat="mountpoint in activeDistro.mountpoints track by $index">
                  <tr>
                    <td style="padding-left: 10px;"><input required ng-readonly="readOnly" name="mountpoint" type="text"
                        ng-model="activeDistro.mountpoints[$index]" class="form-control">
                    </td>
                    <td ng-hide="readOnly">
                      <a ng-click="form.$setDirty();removeMountpoint(mountpoint)">
                        <i class="fa fa-trash distro-trash-icon"></i>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="icon fa fa-warning distro-error" ng-show="diskMountpointsForm.mountpoint.$dirty && diskMountpointsForm.mountpoint.$error.required">mountpoint cannot be blank<br /></div>
            <button type="button" class="btn btn-primary" ng-hide="readOnly" ng-disabled="diskMountpointsForm.mountpoint.$dirty && diskMountpointsForm.$invalid || diskMountpointsForm.mountpoint.$error.required"
              ng-click="form.$setDirty();addMountpoint()"><i class="fa fa-plus"></i>Add Mountpoint</button>
          <div>
            <label class="distro-label">Setup Script:</label>
            <span style="float: right; margin-top: 20px;" class="distro-checkbox checkbox">
              <input ng-disabled="readOnly" type="checkbox" ng-model="activeDistro.setup_as_sudo">Run scripts as sudo
            </span>
          </div>
          <textarea ng-readonly="readOnly" name="script" type="text" wrap="off" class="form-control" rows="7" ng-model="activeDistro.setup"
            style="margin-left: 0px; font-family: monospace"></textarea>

          <div class="dropdown">
            <span class="distro-menu-title">SSH Key:</span>
            <button class="btn btn-default dropdown-toggle" ng-disabled="readOnly" type="button" data-toggle="dropdown">
              <strong class="distro-menu-item">[[activeDistro.ssh_key]]<span class="fa fa-caret-down"></span></strong>
            </button>
            <ul class="dropdown-menu" role="menu" style="margin-left: 63px">
              <li required name="sshKeyForm" ng-click="form.$setDirty();setKeyValue('ssh_key', key.name)" ng-repeat="key in keys"
                role="presentation"><a role="menuitem" tabindex="-1">[[key.name]] - [[key.location]]</a></li>
            </ul>
            <br>
            <div class="icon fa fa-warning distro-error" ng-show="!activeDistro.ssh_key">SSH keys must be configured</div>
          </div>
          <div ng-form name="sshForm">
            <label class="distro-label">SSH Options:</label>
            <div id="ssh-options-table" class="distro-table-scroll">
              <table style="margin-left: -8px;" class="table distro-table">
                <tbody ng-repeat="opt in activeDistro.ssh_options track by $index">
                  <tr>
                    <td style="padding-left: 10px;"><input required ng-readonly="readOnly" name="opt" type="text"
                        ng-model="activeDistro.ssh_options[$index]" class="form-control" placeholder="e.g. BatchMode=yes">
                    </td>
                    <td ng-hide="readOnly">
                      <a ng-click="form.$setDirty();removeSSHOption(opt)">
                        <i class="fa fa-trash distro-trash-icon"></i>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="icon fa fa-warning distro-error" ng-show="sshForm.opt.$dirty && sshForm.opt.$error.required">SSH
              option cannot be blank<br /></div>
            <button type="button" class="btn btn-primary" ng-hide="readOnly" ng-disabled="sshForm.opt.$dirty && sshForm.$invalid || sshForm.opt.$error.required"
              ng-click="form.$setDirty();addSSHOption()"><i class="fa fa-plus"></i>Add SSH Option</button>

            <div ng-show="isStatic()">
              <label class="distro-label">Authorized Keys File:</label>
              <input type="text" ng-readonly="readOnly" name="authorizedKeysFile"
              class="form-control" ng-model="activeDistro.authorized_keys_file" placeholder="Path to file containing authorized SSH keys (e.g. ~/.ssh/authorized_keys)">
            </div>
          </div>

          <div ng-show="isWindows()">
            <label class="distro-label">Root Directory:</label>
            <input type="text" ng-required="isWindows()" name="rootDir" class="form-control" ng-model="activeDistro.bootstrap_settings.root_dir"
              placeholder="Native path to root directory" ng-readonly="readOnly">
            <div class="icon fa fa-warning distro-error" ng-show="form.rootDir.$invalid"> Root directory is required</div><br />
          </div>

          <div ng-show="isNonLegacyProvisioning()">
            <label class="distro-label">Jasper Binary Directory:</label>
            <input type="text" ng-required="isNonLegacyProvisioning()" ng-readonly="readOnly" name="jasperBinaryDir"
              class="form-control" ng-model="activeDistro.bootstrap_settings.jasper_binary_dir" placeholder="Absolute native path to the directory of the Jasper binary">
            <div class="icon fa fa-warning distro-error" ng-show="form.jasperBinaryDir.$invalid"> Jasper binary directory is required</div><br />

            <label class="distro-label">Jasper Credentials Path:</label>
            <input type="text" ng-required="isNonLegacyProvisioning()" ng-readonly="readOnly" name="jasperCredentialsPath"
              class="form-control" ng-model="activeDistro.bootstrap_settings.jasper_credentials_path" placeholder="Absolute native path to the directory containing the Jasper credentials">
            <div class="icon fa fa-warning distro-error" ng-show="form.jasperCredentialsPath.$invalid"> Jasper credentials path is required</div><br />

            <label class="distro-label">Client Directory:</label>
            <input type="text" ng-required="isNonLegacyProvisioning()" ng-readonly="readOnly" name="clientDir"
              class="form-control" ng-model="activeDistro.bootstrap_settings.client_dir" placeholder="Absolute native path to the directory of the evergreen binary">
            <div class="icon fa fa-warning distro-error" ng-show="form.clientDir.$invalid"> Client directory is required</div><br />

            <label class="distro-label">Shell Path:</label>
            <input type="text" ng-required="isNonLegacyProvisioning()"
              ng-readonly="readOnly" name="shellPath"
              class="form-control" ng-model="activeDistro.bootstrap_settings.shell_path" placeholder="Absolute native path to the shell binary file (bash)">
            <div class="icon fa fa-warning distro-error" ng-show="form.shellPath.$invalid"> Shell path is required</div><br />

            <div ng-show="isWindows()">
              <label class="distro-label">Service User:</label>
              <input type="text" ng-required="isWindows() && isNonLegacyProvisioning()"
                ng-readonly="readOnly" name="serviceUser"
                class="form-control" ng-model="activeDistro.bootstrap_settings.service_user" placeholder="Username for setting up Evergreen services">
              <div class="icon fa fa-warning distro-error" ng-show="form.serviceUser.$invalid"> Service user is required</div><br />
            </div>

            <div ng-form name="env">
              <label id="env-table" class="distro-label">Environment Variables:</label>
              <div class="distro-table-scroll">
              <table style="margin-left: -8px;" class="table distro-table" ng-show="activeDistro.bootstrap_settings.env">
                <thead class="muted">
                <tr>
                  <th>Key</th>
                  <th>Value</th>
                </tr>
                </thead>
                <tbody ng-repeat="envVar in activeDistro.bootstrap_settings.env">
                <tr>
                  <td><input ng-readonly="readOnly" type="text" required name="envKey" ng-model="envVar.key" class="form-control"></td>
                  <td><input ng-readonly="readOnly" type="text" ng-model="envVar.value" class="form-control"></td>
                  <td ng-hide="readOnly"><a ng-click="form.$setDirty();removeEnvVar(envVar)"><i class="fa fa-trash distro-trash-icon"></i></a></td>
                </tr>
                </tbody>
              </table>
              </div>
              <div>
              <div class="icon fa fa-warning distro-error" ng-show="env.envKey.$dirty && env.envKey.$error.required">
                Environment key cannot be blank<br />
              </div>
              <button type="button" ng-hide="readOnly" ng-disabled="env.envKey.$dirty && env.envKey.$invalid || env.envKey.$error.required"
                class="btn btn-primary" ng-click="form.$setDirty();addEnvVar()"><i class="fa fa-plus"></i>Add Environment Variable</button>
              </div>
            </div>

            <div ng-show="isLinux()">
              <label class="distro-label">Resource Limits:</label><br />
              <label class="muted">Number of Files:</label>
              <input type="number" ng-readonly="readOnly" name="numFiles"
                class="form-control" ng-model="activeDistro.bootstrap_settings.resource_limits.num_files"
                placeholder="Max number of open file handles. Set -1 for unlimited"
                min="-1">
              <div class="icon fa fa-warning distro-error" ng-show="form.numFiles.$invalid"> Invalid max open files</div><br />

              <label class="muted">Number of Processes:</label>
              <input type="number" ng-readonly="readOnly" name="numProcesses"
                class="form-control" ng-model="activeDistro.bootstrap_settings.resource_limits.num_processes"
                placeholder="Max number of processes. Set -1 for unlimited"
                min="-1">
              <div class="icon fa fa-warning distro-error" ng-show="form.numProcesses.$invalid"> Invalid max processes</div><br />

              <label class="muted">Number of Cgroup Tasks:</label>
              <input type="number" ng-readonly="readOnly" name="numTasks"
                class="form-control" ng-model="activeDistro.bootstrap_settings.resource_limits.num_tasks"
                placeholder="Max number of cgroup tasks (threads). Set -1 for unlimited"
                min="-1">
              <div class="icon fa fa-warning distro-error" ng-show="form.numTasks.$invalid"> Invalid max cgroup tasks</div><br />

              <label class="muted">Locked Memory:</label>
              <input type="number" ng-readonly="readOnly" name="lockedMemoryKB"
                class="form-control" ng-model="activeDistro.bootstrap_settings.resource_limits.locked_memory"
                placeholder="Max size (in KB) that can be locked into memory. Set -1 for unlimited"
                min="-1">
              <div class="icon fa fa-warning distro-error" ng-show="form.lockedMemoryKB.$invalid"> Invalid max locked memory</div><br />

              <label class="muted">Virtual Memory:</label>
              <input type="number" ng-readonly="readOnly" name="virtualMemoryKB"
                class="form-control" ng-model="activeDistro.bootstrap_settings.resource_limits.virtual_memory"
                placeholder="Max size (in KB) of available virtual memory. Set -1 for unlimited"
                min="-1">
              <div class="icon fa fa-warning distro-error" ng-show="form.virtualMemory.$invalid"> Invalid max virtual memory</div><br />
            </div>
            <div ng-form name="preconditionScriptsForm">
              <label class="distro-label">Precondition Scripts:</label>
              <div id="precondition-scripts-table" class="distro-table-scroll">
                <table style="margin-left: -8px;" class="table distro-table">
                  <tbody ng-repeat="script in activeDistro.bootstrap_settings.precondition_scripts track by $index">
                    <tr>
                      <td style="padding-left: 10px;">
                        <label class="muted">Path:</label>
                        <input ng-readonly="readOnly" name="path" type="text" class="form-control"
                               ng-model="activeDistro.bootstrap_settings.precondition_scripts[$index].path"
                               placeholder="Absolute path to the location to put the precondition script."/>
                        <label class="muted">Script:</label>
                        <textarea ng-readonly="readOnly" name="script" type="text" wrap="off" class="form-control" rows="7"
                                  style="margin-left: 0px; font-family: monospace"
                                  ng-model="activeDistro.bootstrap_settings.precondition_scripts[$index].script"
                                  style="margin-left: 0px; font-family: monospace"
                                  placeholder="The precondition script that must run and succeed before Jasper can start (Note: should include a shebang at the beginning)."></textarea>
                      </td>
                      <td ng-hide="readOnly">
                        <a ng-click="form.$setDirty();removePreconditionScript($index)">
                          <i class="fa fa-trash distro-trash-icon"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="icon fa fa-warning distro-error" ng-show="preconditionScriptsForm.path.$dirty &&
                                                           preconditionScriptsForm.path.$error.required">Path to script cannot be blank<br /></div>
              <div class="icon fa fa-warning distro-error" ng-show="preconditionScriptsForm.script.$dirty && preconditionScriptsForm.script.$error.required">
                Script cannot be blank<br />
              </div>
              <button type="button" class="btn btn-primary" ng-hide="readOnly"
                                                            ng-disabled="preconditionScriptsForm.script.$dirty && preconditionScriptsForm.$invalid || preconditionScriptsForm.script.$error.required"
                ng-click="form.$setDirty();addPreconditionScript()">
                <i class="fa fa-plus"></i>
                Add Precondition Script
              </button>
            </div>
          </div>
          <div>
            <label class="distro-label">Home Volume Format Command:</label>
            <input ng-readonly="readOnly" name="formatCommand" ng-required="activeDistro.is_virtual_workstation" type="text" class="form-control" ng-model="activeDistro.home_volume_settings.format_command">
            <div class="icon fa fa-warning distro-error"
              ng-show="form.formatCommand.$dirty && form.formatCommand.$error.required || form.formatCommand.$invalid"> Format command is required
            </div>
          </div>
          <div ng-show="activeDistro.is_virtual_workstation">
            <label class="distro-label">Icecream Scheduler Host:</label>
            <input ng-readonly="readOnly" name="icecreamSchedulerHost" type="text"
              class="form-control" ng-model="activeDistro.icecream_settings.scheduler_host"
              placeholder="Host name to connect to the icecream scheduler">
            <label class="distro-label">Icecream Config File Path:</label>
            <input ng-readonly="readOnly" name="icecreamConfigPath" type="text"
              class="form-control" ng-model="activeDistro.icecream_settings.config_path"
              placeholder="Path to the icecream config file">
          </div>
        </div>
        <div class="dropdown">
          <span class="distro-menu-title">Project Cloning Method:</span>
            <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="true" ng-disabled="readOnly">
              <strong class="distro-menu-item">[[activeDistro.clone_method | cloneMethodDisplay:this]]<span class="fa fa-caret-down"></span></strong>
            </button>
            <ul class="dropdown-menu" style="margin-left: 125px" role="menu">
              <li required name="cloneMethodForm" ng-click="form.$setDirty();activeDistro.clone_method = cloneMethod.id" ng-repeat="cloneMethod in cloneMethods"
                role="presentation"><a role="menuitem" tabindex="-1">[[cloneMethod.display]]</a></li>
            </ul>
        </div>
        <div class="icon fa fa-warning distro-error" ng-show="form.cloneMethodForm.$dirty && form.cloneMethodForm.$invalid || cloneMethodForm.$error.required">Clone method is required</div>
        <div>
          <div ng-form name="expansions">
            <label class="distro-label">Expansions:</label>
            <div id="expansions-table" class="distro-table-scroll">
              <table style="margin-left: -8px;" class="table distro-table" ng-show="activeDistro.expansions">
                <thead class="muted">
                  <tr>
                    <th>Key</th>
                    <th>Value</th>
                  </tr>
                </thead>
                <tbody ng-repeat="expansion in activeDistro.expansions">
                  <tr>
                    <td><input ng-readonly="readOnly" type="text" required name="expKey" ng-model="expansion.key" class="form-control"></td>
                    <td><input ng-readonly="readOnly" type="text" ng-model="expansion.value" class="form-control"></td>
                    <td ng-hide="readOnly"><a ng-click="form.$setDirty();removeExpansion(expansion)"><i class="fa fa-trash distro-trash-icon"></i></a></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div>
              <div class="icon fa fa-warning distro-error" ng-show="expansions.expKey.$dirty && expansions.expKey.$error.required">Expansion
                key cannot be blank<br /></div>
              <button type="button" ng-hide="readOnly" ng-disabled="(expansions.expKey.$dirty && expansions.$invalid) || expansions.expKey.$error.required"
                class="btn btn-primary" ng-click="form.$setDirty();addExpansion()"><i class="fa fa-plus"></i>Add
                Expansion</button>
            </div>
          </div>
          <div>
            <label class="distro-label">Valid Projects:</label>
            <textarea ng-readonly="readOnly" name="valid_projects" ng-list="&#10;" ng-trim="false" class="form-control" rows="5"
              ng-model="activeDistro.valid_projects" style="margin-left: 0px"></textarea>
          </div>
          <div>
            <label class="distro-label">Notes:</label>
            <textarea ng-readonly="readOnly" name="notes" class="form-control" rows="5"
              ng-model="activeDistro.note" style="margin-left: 0px"></textarea>
          </div>
          <br>
          <div>
            <p class="distro-checkbox checkbox">
              <input ng-disabled="readOnly" type="checkbox" ng-model="activeDistro.spawn_allowed">
              Allow users to spawn these hosts for personal use.
            </p>
            <p class="distro-checkbox checkbox" ng-disabled="!activeDistro.spawn_allowed || !isLinux()">
              <input ng-disabled="readOnly" type="checkbox" ng-model="activeDistro.is_virtual_workstation">
              Allow users to use spawnhosts of this distro as virtual workstations.
            </p>
            <p class="distro-checkbox checkbox">
              <input ng-disabled="readOnly" type="checkbox" ng-model="activeDistro.is_cluster">
              Mark distro as a cluster (jobs are not run on this host, used for special purposes).
            </p>
            <p class="distro-checkbox checkbox">
              <input ng-disabled="readOnly" type="checkbox" ng-model="activeDistro.disable_shallow_clone">
              Disable shallow clone for this distro.
            </p>
            <p class="distro-checkbox checkbox">
              <input type="checkbox" ng-model="activeDistro.disabled">
              Disable queueing this distro. Tasks already in the task queue will be removed.
            </p>
            <span class="warning-text" ng-show="activeDistro.disabled && activeDistro.host_allocator_settings.minimum_hosts > 0"><i class="fa fa-warning"></i>
This will still allow the minimum number of hosts to start.
            </span>
          </div>
        </div>
      </div>
      <div ng-hide="readOnly">
        <br><br>
        <p class="distro-checkbox checkbox" style="margin-left: 5px">
          <input ng-disabled="readOnly" type="checkbox" name="shouldDeco" ng-model="shouldDeco">
          Decommission hosts of this distro for this update
        </p>
        <div ng-show="isNonLegacyProvisioning()">
          <p class="distro-checkbox checkbox" style="margin-left: 5px" >
            <input ng-show="isNonLegacyProvisioning() && !shouldReprovisionToNew" ng-disabled="readOnly || !isNonLegacyProvisioning() || shouldDeco || shouldReprovisionToNew" type="checkbox" name="shouldRestartJasper" ng-model="shouldRestartJasper">
            Restart Jasper service on running hosts of this distro for this update
          </p>
          <p class="distro-checkbox checkbox" style="margin-left: 5px" >
            <input ng-show="isNonLegacyProvisioning() && !shouldRestartJasper" ng-disabled="readOnly || !isNonLegacyProvisioning() || shouldDeco || shouldRestartJasper" type="checkbox" name="shouldReprovisionToNew" ng-model="shouldReprovisionToNew">
            Reprovision running hosts of this distro for this update
          </p>
        </div>
        <button type="button" class="btn btn-primary" style="float: left; margin-left: 5px;" ng-disabled="form.$pristine || (form.$dirty && form.$invalid) || !validForm()"
          ng-click="saveConfiguration()">Save Configuration</button>
        <button type="button" class="btn btn-danger" style="float: right; margin-right: 5px;" ng-show="remove" ng-click="openConfirmationModal('removeDistro')"
          ng-disabled="activeDistro.new">Remove Configuration</button>
        <admin-modal>
          <remove-distro ng-show="confirmationOption == 'removeDistro'"></remove-distro>
        </admin-modal>
      </div>
    </div>
  </div>
</div>
</div>
{{end}}
