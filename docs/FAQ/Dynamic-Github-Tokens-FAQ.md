# Dynamic Github Access Tokens FAQ

## Which permissions should the github app have?

The permissions for you app should be limited to only what is necessary. The permissions that are necessary will depend on how you plan to use the generated tokens.

- **contents:read**: To use the app to `git clone`, using [shell.exec](Project-Configuration/Project-Commands/shellexec) or [subprocess.exec](Project-Configuration/Project-Commands/subprocessexec), request `contents:read` under repository permissions. This also applies if you plan to use the token to pass it into [git.get_project](Project-Configuration/Project-Commands/gitget_project).
- **contents:write**: To use the app to `git push`, request `contents:write` under repository permissions.
- **checks:write**: To use the app to generate a token to pass into [github check runs](Project-Configuration/Github-Integrations/github-check-runs) (this is not available yet but will be soon), request `checks:write` under repository permissions.

## Can more than one app be associated with my project?

No, only one app per project is supported.

## Why am I seeing `HTTP status code 401: 401 (Unauthorized): requester does not have permission to create a token` error when I try to clone with a generated token?

It is possible that the token is being generated with permissions being fully restricted to `No Permissions` in the project settings. Double check that the [project settings](Github-Integrations#dynamic-github-access-tokens) did not restrict this requester to `No Permissions`.

## Why am I seeing a `Remote: Repository not found` error when I try to clone with a generated token?

A few things may cause this issue:

- The GitHub app associated with the project does not have permission to clone this repo.
- The token is being generated with _restricted permissions_. Double check that _both_ the project settings and the command, if they specify restricted permissions, include `contents:read`.
- In some cases, you may need to specify the owner and repo using the [github.generate_token command](Project-Configuration/Project-Commands#githubgenerate_token) parameters when generating a token, especially if the repository you want to clone has a different owner than your Evergreen project.

## Why am I seeing `the intersection of the project setting's requester permissions and provided permissions does not have any permissions to create a token`?

The token restrictions in the project settings and those specified in the command can intersect in a way that results in the token having no restrictions. For example, if the project settings specifies `{ checks: read }` for the requester, a token generated by that requester will have `{ checks: read }` permissions and nothing else. Therefore, if the command specifies `{ actions: read }` for example, `actions:read` will not be added because project settings restricts it to only `checks:read`, and because the command is restricting it to only `actions:read`, the `checks:read` from the project is now also not available, leaving it with no permissions and that error. For more information on this, see [project settings](Github-Integrations#dynamic-github-access-tokens).

## Why am I seeing `remote: Invalid username or password fatal: Authentication failed for` when I try use a generated token?

It is possible that the GitHub app used to generate the token does not have access to this repository.
Alternatively, the token might have expired. Make sure that the token was not generated more than an hour before use.

## Why am I seeing `github app auth not found for project` when I try to create a token?

There is likely no app saved for your project. Double check that the app is set up properly by following the instructions [here](Github-Integrations#dynamic-github-access-tokens).

## Why is github.generate_token failing with `request canceled (Client.Timeout exceeded while awaiting headers)`?

A few things may cause this issue:

- There may be a typo in the owner or repository used when generating the token. Look for the log that says `creating github dynamic access token for 'owner/repo'` and copy/paste it into github to ensure that the owner/repo exist and are spelled correctly.
- Parts of the evergreen system or github may be down.
- There may be something wrong with the github app ID or the github app key saved in [project settings](Github-Integrations#dynamic-github-access-tokens).
- You may be requesting a permission that your app doesn't have. For example, you may be specifying `contents: read` in the command but the app you provided in your project settings doesn't have `contents: read` permissions for the repo.

## How can I use a generated token for private go modules?

After using the github.generate_token command to generate a token, you can then use it in a global git config with something like `git config --global url."https://x-access-token:${generated_token}@github.com/".insteadOf https://github.com/`. Evergreen will reset the global git config at the end of tasks (or for task groups, after the all the tasks in the task group tasks have finished).

## My generated token isn't working, how do I figure out why?

Below is a recommended order for debugging steps:

- [Check if GitHub is down](https://www.githubstatus.com).
- If your current setup involves multiple steps or scripts, create a task that isolates the problem by only generating a token and immediately using it to do the operation you are trying to do. You can model it after the example [here](Project-Configuration/Project-Commands#githubgenerate_token). If it works in this isolated setting, debug efforts can be focused on yaml syntax and [token lifespan and scope](Project-Configuration/Project-Commands#token-lifespan).
- Double check the app permissions on the [project settings](Github-Integrations#dynamic-github-access-tokens) page to make sure that what you are trying to do is not restricted.
- Double check the permissions you specified in your project yaml when [generating the token](Project-Configuration/Project-Commands#githubgenerate_token) to make sure that what you are trying to do is not restricted.
- Use a script like [shell.exec](Project-Configuration/Project-Commands/shellexec) to print the length of the generated token to make sure it's not 0. If it is, delete your github app in [project settings](Github-Integrations#dynamic-github-access-tokens) and save it again to make sure that it was saved correctly. Make sure that you are saving github app ID or the github app key and not the Client ID.
- Test your app outside of Evergreen by generating a token and then using that token with the operation that doesn't work to make sure that a token generated by your app is powerful enough. While this is not officially supported by Evergreen, [Zack created a helpful script](https://github.com/10gen/employees/tree/master/home/zackary.santana/utils/github_dynamic_tokens) that can be used to generate a token on your machine. If you fail at this step, read the [github documentation](https://docs.github.com/en/rest/authentication/permissions-required-for-github-apps?apiVersion=2022-11-28) to figure out what permissions are needed for the thing you are trying to do and check in with the team that created the github app for you to double check that your app has those permissions. You can see all the available permissions [here](https://github.com/settings/apps/new). If your app has the right permissions but your token can't do the operation you expect on your machine, you may need to reach out to github for support.
